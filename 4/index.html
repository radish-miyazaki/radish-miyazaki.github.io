<!DOCTYPE html>
<html lang="ja-jp">
  <head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Map型と ユーティリティ型 | method_missing(*)</title>
  <link rel="stylesheet" href="https://radish-miyazaki.github.io/assets/css/post.css" />
  <script defer src="https://radish-miyazaki.github.io/assets/js/lbox.js"></script>
  
  <link rel="stylesheet" href="https://radish-miyazaki.github.io/assets/css/common.css" />
  <link rel="icon" type="image/png" href="https://radish-miyazaki.github.io/assets/icons/ruby.png" />
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://radish-miyazaki.github.io/post-cover.png"/>

<meta name="twitter:title" content="Map型と ユーティリティ型"/>
<meta name="twitter:description" content="概要 前回の社内勉強会でMap型が話題に上がり、自分の復習のためにまとめる。
マップ型とは オブジェクトのキーの値とプロパティの型を指定することができる。 以下に例を示す。
type Weekday = &#39;Mon&#39; | &#39;Tue&#39; | &#39;Wed&#39; | &#39;Thu&#39; | &#39;Fri&#39; type Day = Weekday | &#39;Sat&#39; | &#39;Sun&#39; // 現在の曜日と次の曜日の組み合わせ let nextDay: {[K in Weekday]: Day} = { Mon: &#39;Tue&#39; } 上記は以下のようなエラーを示す。"/>

  <meta property="og:title" content="Map型と ユーティリティ型" />
<meta property="og:description" content="概要 前回の社内勉強会でMap型が話題に上がり、自分の復習のためにまとめる。
マップ型とは オブジェクトのキーの値とプロパティの型を指定することができる。 以下に例を示す。
type Weekday = &#39;Mon&#39; | &#39;Tue&#39; | &#39;Wed&#39; | &#39;Thu&#39; | &#39;Fri&#39; type Day = Weekday | &#39;Sat&#39; | &#39;Sun&#39; // 現在の曜日と次の曜日の組み合わせ let nextDay: {[K in Weekday]: Day} = { Mon: &#39;Tue&#39; } 上記は以下のようなエラーを示す。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://radish-miyazaki.github.io/4/" /><meta property="og:image" content="https://radish-miyazaki.github.io/post-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-03-10T00:00:00+00:00" />


</head>
  <body>
    <main>
      <header>
  <a class="site-title" href="https://radish-miyazaki.github.io">method_missing(*)</a>
</header>

      <section class="article">
        <div class="article-header">
          <h2 class="article-title">Map型と ユーティリティ型</h2>
          <small class="date">2022-03-10 (Thu)</small>
          <div class="tags">
            
            <a href="https://radish-miyazaki.github.io/tags/typescript" class="tag">typescript</a>
            
          </div>
        </div>
        <div class="content"><h2 id="概要">概要</h2>
<p>前回の社内勉強会で<code>Map</code>型が話題に上がり、自分の復習のためにまとめる。</p>
<h2 id="マップ型とは">マップ型とは</h2>
<p><strong>オブジェクトのキーの値</strong>と<strong>プロパティの型を指定</strong>することができる。 以下に例を示す。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Weekday</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Mon&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Tue&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Wed&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Thu&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Fri&#39;</span>
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Day</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Weekday</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Sat&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;Sun&#39;</span>

<span style="color:#75715e">// 現在の曜日と次の曜日の組み合わせ
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nextDay</span><span style="color:#f92672">:</span> {[<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">Weekday</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">Day</span>} <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">Mon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Tue&#39;</span>  
}
</code></pre></div><p>上記は以下のようなエラーを示す。</p>
<pre><code>型 '{ Mon: &quot;Tue&quot;; }'は、型'{ Mon: Day; Tue: Day; Wed: Day; Thu: Day; Fri: Day; }': Tue, Wed, Thu, Fri
のプロパティに見当たりません。
</code></pre><p>これは、<code>Weekday</code>のキーが欠けているために起こるエラーである。</p>
<p>したがって、下記のように全てのパターンを書き出してあげるとエラーは消える。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nextDay</span><span style="color:#f92672">:</span> {[<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">Weekday</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">Day</span>} <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">Mon</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Tue&#39;</span>,
  <span style="color:#a6e22e">Tue</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Wed&#39;</span>,
  <span style="color:#a6e22e">Wed</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Thu&#39;</span>,
  <span style="color:#a6e22e">Thu</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Fri&#39;</span>,
  <span style="color:#a6e22e">Fri</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Sat&#39;</span>
}
</code></pre></div><p>また、<strong>インデックスシグネチャ(<code>{ [index:string] : {message: string} }</code>)<strong>と同様、<strong>1つのオブジェクト</strong>につき</strong>最大1つのマップ型</strong>を持つことができる。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MyMappedType</span> <span style="color:#f92672">=</span> {
  [<span style="color:#a6e22e">Key</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">UnionType</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">ValueType</span>
}
</code></pre></div><p><code>Key</code>はキー、<code>UnionType</code>は合併型、<code>ValueType</code>は値の型を表す。</p>
<p>マップ型は、オブジェクトのキーと値に型を与えるだけでなく、<strong>ルックマップ型と組み合わせると、どの値の型がどのキーの名前に対応するかを制限できる</strong>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Account</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">number</span>
  <span style="color:#a6e22e">isEmployee</span>: <span style="color:#66d9ef">boolean</span>
  <span style="color:#a6e22e">notes</span>: <span style="color:#66d9ef">string</span>[]
}

<span style="color:#75715e">// すべてのフィールドを省略可能にする
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">OptionalAccount</span> <span style="color:#f92672">=</span> {
  [<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">Account</span>]<span style="color:#f92672">?:</span> <span style="color:#a6e22e">Account</span>[<span style="color:#a6e22e">K</span>]
}

<span style="color:#75715e">// すべてのフィールドをnull許容する
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NullableAccount</span> <span style="color:#f92672">=</span> {
  [<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">Account</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">Account</span>[<span style="color:#a6e22e">K</span>] <span style="color:#f92672">|</span> <span style="color:#66d9ef">null</span>
}

<span style="color:#75715e">// すべてのフィールドを読み取り専用にする
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ReadonlyAccount</span> <span style="color:#f92672">=</span> {
  <span style="color:#66d9ef">readonly</span> [<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">Account</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">Account</span>[<span style="color:#a6e22e">K</span>]
}

<span style="color:#75715e">// 全てのフィールドを再び書き込み可能になる（Accountと同じ）
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Account2</span> <span style="color:#f92672">=</span> {
  <span style="color:#f92672">-</span><span style="color:#66d9ef">readonly</span> [<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">ReadonlyAccount</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">Account</span>[<span style="color:#a6e22e">K</span>]
}

<span style="color:#75715e">// すべてのフィールドを再び必須にする（Accountと同じ）
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Account3</span> <span style="color:#f92672">=</span> {
  [<span style="color:#a6e22e">K</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">OptionalAccount</span>]<span style="color:#f92672">-?:</span> <span style="color:#a6e22e">Account</span>[<span style="color:#a6e22e">K</span>]
}
</code></pre></div><h3 id="上記コードの補足">上記コードの補足</h3>
<p><code>-</code>はマイナス演算子と呼び、マップ型でのみ利用可能な特別な型演算子である。</p>
<p>これを用いると、<code>?</code>や<code>readonly</code><strong>を取り消す</strong>ことができ、フィールドを必須や書き込み可能に戻すことができる。</p>
<p>ちなみに、プラス演算子（<code>+</code>）も存在するが、暗黙的なものなので使う場面は無いと思われる。</p>
<p>つまり、<code>readonly</code>は<code>+readonly</code>と同等であり、<code>?</code>は<code>+?</code>と同等である。</p>
<hr>
<h2 id="組み込みのマップ型">組み込みのマップ型</h2>
<p>マップ型を内部的に用いている組み込み型を一部紹介する。</p>
<h3 id="record">Record</h3>
<p>オブジェクトのキーの値とプロパティの値の型を指定する。</p>
<p>キーにすることができるのは、<strong>インデックスシグネチャ</strong>が<code>string</code>, <code>number</code>だけであるのに対して、<code>string</code>, <code>number</code>, <code>symbol</code>のサブタイプである点が特徴。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Record</span>&lt;<span style="color:#f92672">K</span> <span style="color:#a6e22e">extends</span> <span style="color:#a6e22e">string</span> <span style="color:#960050;background-color:#1e0010">|</span> <span style="color:#a6e22e">number</span> <span style="color:#960050;background-color:#1e0010">|</span> <span style="color:#a6e22e">symbol</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">T</span>&gt; <span style="color:#f92672">=</span> { 
  [<span style="color:#a6e22e">P</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">K</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">T</span>; 
}
</code></pre></div><h3 id="partial">Partial</h3>
<p>Object内の全てのフィールドを省略可能と指定する。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Partial</span>&lt;<span style="color:#f92672">T</span>&gt; <span style="color:#f92672">=</span> { 
  [<span style="color:#a6e22e">P</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">T</span>]<span style="color:#f92672">?:</span> <span style="color:#a6e22e">T</span>[<span style="color:#a6e22e">P</span>]; 
}
</code></pre></div><h3 id="required">Required</h3>
<p>Object内の全てのフィールドを必須（省略不可）と指定する。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Required</span>&lt;<span style="color:#f92672">T</span>&gt; <span style="color:#f92672">=</span> { 
  [<span style="color:#a6e22e">P</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">T</span>]<span style="color:#f92672">-?:</span> <span style="color:#a6e22e">T</span>[<span style="color:#a6e22e">P</span>]; 
}
</code></pre></div><h3 id="readonly">Readonly</h3>
<p>Object内のすべてのフィールドを読み取り専用と指定する。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Readonly</span>&lt;<span style="color:#f92672">T</span>&gt; <span style="color:#f92672">=</span> { 
  <span style="color:#66d9ef">readonly</span> [<span style="color:#a6e22e">P</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">keyof</span> <span style="color:#a6e22e">T</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">T</span>[<span style="color:#a6e22e">P</span>]; 
}
</code></pre></div><h3 id="pick">Pick</h3>
<p>指定されたKeysだけを持つ、Objectのサブタイプを返す。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Pick</span>&lt;<span style="color:#f92672">T</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">K</span> <span style="color:#a6e22e">extends</span> <span style="color:#a6e22e">keyof</span> <span style="color:#a6e22e">T</span>&gt; <span style="color:#f92672">=</span> { 
  [<span style="color:#a6e22e">P</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">K</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">T</span>[<span style="color:#a6e22e">P</span>]; 
}
</code></pre></div><h2 id="参考文献">参考文献</h2>
<ul>
<li><a href="https://www.oreilly.co.jp/books/9784873119045/">プログラミングTypeScript ――スケールするJavaScriptアプリケーション開発</a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html">公式ドキュメント</a></li>
</ul>
</div>
      </section>
      <footer>
  <p>&copy; 2023 Radish All rights reserved. </p>
</footer>
    </main>
  </body>
</html>
